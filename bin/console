#!/usr/bin/env php
<?php

namespace RetailCrm\Api;

require __DIR__ . '/../vendor/autoload.php';

use ReflectionClass;
use RetailCrm\Api\Component\PhpFilesIterator;
use Symfony\Component\Console\Application;

$application = new Application();
$commands    = new PhpFilesIterator(implode(DIRECTORY_SEPARATOR, [__DIR__, '..', 'src', 'Command']));

foreach ($commands as $command) {
    if (!array_key_exists('fqn', $command)) {
        continue;
    }

    $commandFqn = $command['fqn'];

    if (class_exists($commandFqn) && !(new ReflectionClass($commandFqn))->isAbstract()) {
        $application->add(new $commandFqn());
    }
}

$application->setName('RetailCRM API Client Management Tool');
$application->run();
